# Use the latest 2.1 version of CircleCI pipeline processing engine, see https://circleci.com/docs/2.0/configuration-reference/
version: 2.1

# Use a package of configuration called an orb, see https://circleci.com/docs/2.0/orb-intro/
jobs:
  run-staging:
    docker:
      - image: govau/cga-deploy-cf-smoke-tests:latest
    steps:
      - checkout
      - run: CF_API="${CF_API_STAGING}" CF_PASSWORD="${CF_PASSWORD_STAGING}" ./run.sh 
  run-prod:
    docker:
      - image: govau/cga-deploy-cf-smoke-tests:latest
    steps:
      - checkout
      - run: CF_API="${CF_API_PROD}" CF_PASSWORD="${CF_PASSWORD_PROD}" ./run.sh 
workflows:
  run-hourly:
    triggers:
      - schedule:
          cron: "10 0,6,12,18 * * *"
          filters:
             branches:
               only:
                 - master
    jobs:
      - run-prod
      - run-staging
  run-now:
    jobs:
      - run-prod
      - run-staging
